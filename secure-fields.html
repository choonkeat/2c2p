<!DOCTYPE html>
<html>
<head>
    <title>2C2P SecureField</title>
    <script type="text/javascript" src="https://2c2p-uat-cloudfront.s3-ap-southeast-1.amazonaws.com/2C2PPGW/secureField/my2c2p-secureFields.1.0.0.min.js"></script>
    <script type="text/javascript" src="https://demo2.2c2p.com/2C2PFrontEnd/SecurePayment/api/my2c2p-sandbox.1.7.3.min.js"></script>
    <style>
        ._2c2pPaymentField { margin: 5px; }
        ._2c2pCard { color: blue; }
        ._2c2pMonth { color: brown; }
        ._2c2pYear { color: red; }
        ._2c2pCvv { color: green; }
        ._2c2pPaymentFieldError { color: red; font-style: italic; }
    </style>
</head>
<body>
    <form id="2c2p-payment-form" action="https://choonkeat-local.ngrok.dev/process-payment" method="POST"></form>
    <input type="button" value="Checkout" onclick="Checkout()" />

    <script type="text/javascript">
        function Checkout() {
            ClearFormErrorMessage();
            My2c2p.getEncrypted("2c2p-payment-form", function(encryptedData, errCode, errDesc) {
                DisplayFormErrorMessage(errCode, errDesc);
                if (errCode != 0) {
                    DisplayFormErrorMessage(errCode, errDesc);
                } else {
                    var form = document.getElementById("2c2p-payment-form");
                    if (form != undefined) {
                        // Send encryptedData to your backend:
                        // encryptedData.encryptedCardInfo - used to make card payment
                        // encryptedData.maskedCardInfo   - first 6 and last 4 masked PAN
                        // encryptedData.expMonthCardInfo - card expiry month
                        // encryptedData.expYearCardInfo  - card expiry year
                        form.submit();
                    }
                }
            });
        }

        function DisplayFormErrorMessage(errCode, errDesc) {
            var errControl;
            switch (errCode) {
                case 1:
                case 2:
                    errControl = document.getElementById('2c2pError-cardnumber');
                    break;
                case 3:
                case 8:
                case 9:
                    errControl = document.getElementById('2c2pError-month');
                    break;
                case 4:
                case 5:
                case 6:
                case 7:
                    errControl = document.getElementById('2c2pError-year');
                    break;
            }

            if (errControl != undefined) {
                errControl.innerHTML = errDesc;
                errControl.focus();
            } else {
                console.log(errDesc + '(' + errCode + ')');
            }
        }

        function ClearFormErrorMessage() {
            var errSpans = Array.prototype.slice.call(document.getElementsByClassName('_2c2pPaymentFieldError'));
            if (errSpans.length > 0) {
                errSpans.forEach(function(errSpan) { errSpan.innerHTML = ""; });
            }
        }
    </script>
</body>
</html>